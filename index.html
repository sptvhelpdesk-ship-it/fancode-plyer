<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Sports Player</title>
  
  <!-- JW Player Library -->
  <script src="https://cdn.jwplayer.com/libraries/IDzF9Zmk.js"></script>

  <style>
    html, body {
      margin: 0; height: 100%; background: black;
      display: flex; flex-direction: column; overflow: hidden;
    }
    #player {
      flex: 1; width: 100%; height: 100vh; background: black;
    }
    #loading-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); display: flex; justify-content: center;
      align-items: center; z-index: 1000; color: white;
      font-family: Arial, sans-serif; flex-direction: column;
    }
    .spinner {
      width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1);
      border-radius: 50%; border-top-color: #e94560;
      animation: spin 1s linear infinite; margin-bottom: 15px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    #match-info {
      position: absolute; top: 15px; left: 15px; color: white;
      background: rgba(233, 69, 96, 0.9); padding: 8px 15px;
      border-radius: 20px; font-size: 14px; z-index: 10;
      display: none; font-family: Arial, sans-serif; font-weight: bold;
    }

    .jw-quality-selector {
      position: absolute; bottom: 60px; right: 20px;
      background: rgba(28, 28, 28, 0.9); backdrop-filter: blur(5px);
      border-radius: 6px; overflow: hidden; z-index: 100;
      display: none; box-shadow: 0 0 20px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1); font-family: Arial, sans-serif; min-width: 140px;
    }
    .jw-quality-selector.show { display: block; }
    .jw-quality-item {
      padding: 10px 20px; color: rgba(255,255,255,0.8); cursor: pointer;
      font-size: 14px; transition: all 0.2s; text-align: right;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .jw-quality-item:hover { background: rgba(233, 69, 96, 0.3); color: white; }
    .jw-quality-item.active { background: #e94560; color: white; font-weight: bold; position: relative;}
    .jw-quality-item.active::before { content: 'âœ“'; position: absolute; left: 10px; color: white; }
    
    #quality-loading {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8); color: white; padding: 8px 16px;
      border-radius: 30px; font-size: 14px; z-index: 30; display: none;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>

  <div id="loading-overlay">
    <div class="spinner"></div>
    <div id="loading-text">Loading Stream...</div>
  </div>
  <div id="quality-loading">Switching quality...</div>
  <div id="match-info"></div>
  <div id="quality-selector" class="jw-quality-selector"></div>

  <div id="player"></div>

  <script>
    const jsonUrl = 'https://raw.githubusercontent.com/Jitendra-unatti/fancode/refs/heads/main/data/fancode.json';
    const proxyBaseUrl = 'https://allinonereborn.online/fcww/live222.php?url=';
    const urlParams = new URLSearchParams(window.location.search);
    const matchId = urlParams.get('id');

    let player = null;
    let currentQuality = '';
    let qualityUrls = [];
    let isPlayerReady = false;
    let isLoading = false;

    function showLoading(show, text = "Loading Stream...") {
      document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
      if(show) document.getElementById('loading-text').innerText = text;
    }

    function showMatchInfo(title, status) {
      const el = document.getElementById('match-info');
      el.innerText = title + ' - ' + status;
      el.style.display = 'block';
    }

    // à¦¹à§à¦¬à¦¹à§ à¦…à¦°à¦¿à¦œà¦¿à¦¨à¦¾à¦² à¦²à¦œà¦¿à¦•: Raw Text à¦¥à§‡à¦•à§‡ à¦†à¦²à¦¾à¦¦à¦¾ à¦†à¦²à¦¾à¦¦à¦¾ à¦•à§‹à§Ÿà¦¾à¦²à¦¿à¦Ÿà¦¿ à¦²à¦¿à¦‚à¦• à¦¬à§‡à¦° à¦•à¦°à¦¾
    function extractStreamUrls(m3u8Text) {
      if (!m3u8Text) return [];
      const lines = m3u8Text.split('\n');
      const streams = [];
      
      const qualityMap = {
        '240p': { bandwidth: 446936, order: 1 },
        '360p': { bandwidth: 702376, order: 2 },
        '480p': { bandwidth: 1023224, order: 3 },
        '540p': { bandwidth: 1278664, order: 4 },
        '720p': { bandwidth: 1789512, order: 5 },
        '1080p': { bandwidth: 3322120, order: 6 }
      };

      for (let line of lines) {
        line = line.trim();
        if (line.startsWith('http')) {
          let quality = 'Auto';
          if (line.includes('240p')) quality = '240p';
          else if (line.includes('360p')) quality = '360p';
          else if (line.includes('480p')) quality = '480p';
          else if (line.includes('540p')) quality = '540p';
          else if (line.includes('720p')) quality = '720p';
          else if (line.includes('1080p')) quality = '1080p';

          streams.push({
            url: line,
            quality: quality,
            order: qualityMap[quality]?.order || 0
          });
        }
      }
      return streams.sort((a, b) => b.order - a.order); // 1080p à¦‰à¦ªà¦°à§‡ à¦¥à¦¾à¦•à¦¬à§‡
    }

    function buildQualityMenu() {
      const selector = document.getElementById('quality-selector');
      selector.innerHTML = '';
      qualityUrls.forEach(stream => {
        const item = document.createElement('div');
        item.className = 'jw-quality-item';
        if(stream.quality === currentQuality) item.classList.add('active');
        item.innerText = stream.quality;
        item.onclick = (e) => {
          e.stopPropagation();
          changeQuality(stream.url, stream.quality);
          document.getElementById('quality-selector').classList.remove('show');
        };
        selector.appendChild(item);
      });
    }

    function addQualityButton() {
      if (!player) return;
      const checkExist = setInterval(() => {
        const rightBar = document.querySelector('.jw-right');
        if (rightBar) {
          clearInterval(checkExist);
          const btn = document.createElement('div');
          btn.className = 'jw-icon jw-icon-inline jw-button-color jw-reset jw-quality-btn';
          btn.style.cssText = 'display:flex; align-items:center; justify-content:center; cursor:pointer; width:44px; height:100%;';
          btn.innerHTML = `<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19.4 13c.1-.6.1-1.3 0-1.9l2.1-1.6c.2-.2.3-.5.1-.7l-2-3.5c-.2-.3-.5-.4-.8-.3l-2.5 1c-.5-.4-1.1-.7-1.7-1l-.4-2.6c0-.3-.3-.5-.6-.5h-4c-.3 0-.6.2-.6.5l-.4 2.6c-.6.3-1.2.6-1.7 1l-2.5-1c-.3-.1-.6 0-.8.3l-2 3.5c-.1.2-.1.5.1.7l2.1 1.6c-.1.6-.1 1.3 0 1.9l-2.1 1.6c-.2.2-.3.5-.1.7l2 3.5c.2.3.5.4.8.3l2.5-1c.5.4 1.1.7 1.7 1l.4 2.6c0 .3.3.5.6.5h4c.3 0 .6-.2.6-.5l.4-2.6c.6-.3 1.2-.6 1.7-1l2.5 1c.3.1.6 0 .8-.3l2-3.5c.1-.2.1-.5-.1-.7l-2.1-1.6zm-7.4 2.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"/></svg>`;
          
          btn.onclick = (e) => { 
            e.stopPropagation(); 
            document.getElementById('quality-selector').classList.toggle('show'); 
          };
          
          const fullscreenBtn = rightBar.querySelector('.jw-icon-fullscreen') || rightBar.lastChild;
          if (fullscreenBtn) fullscreenBtn.parentNode.insertBefore(btn, fullscreenBtn);
          else rightBar.appendChild(btn);

          document.addEventListener('click', (e) => {
            if (!btn.contains(e.target) && !document.getElementById('quality-selector').contains(e.target)) {
              document.getElementById('quality-selector').classList.remove('show');
            }
          });
        }
      }, 500);
    }

    function changeQuality(url, label) {
      if (!player || !isPlayerReady || isLoading) return;
      isLoading = true;
      currentQuality = label;
      buildQualityMenu();
      
      document.getElementById('quality-loading').style.display = 'block';
      const time = player.getPosition();
      
      const proxiedUrl = proxyBaseUrl + encodeURIComponent(url);
      
      player.load([{ file: proxiedUrl, label: label }]);
      player.once('play', () => {
        document.getElementById('quality-loading').style.display = 'none';
        isLoading = false;
        if(time > 0) player.seek(time);
      });
    }

    async function loadStreamFromId() {
      if (!matchId) return showLoading(true, "Error: No match ID provided in URL!");

      try {
        const res = await fetch(jsonUrl);
        const data = await res.json();
        const match = data.matches.find(m => m.match_id == matchId);

        if (!match) return showLoading(true, "No match found with ID: " + matchId);
        
        showMatchInfo(match.title, match.status);
        if (match.status !== "LIVE") return showLoading(true, "This match is not live right now.");

        // ðŸ‘‰ à¦¸à¦ à¦¿à¦• à¦²à¦œà¦¿à¦•: JSON à¦à¦° auto_streams[0].auto à¦¥à§‡à¦•à§‡ à¦•à¦¾à¦à¦šà¦¾ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦¨à§‡à¦“à§Ÿà¦¾
        const rawM3u8Text = match.auto_streams && match.auto_streams[0] ? match.auto_streams[0].auto : null;

        if (!rawM3u8Text) return showLoading(true, "No valid stream data found.");

        qualityUrls = extractStreamUrls(rawM3u8Text);

        if (!qualityUrls || qualityUrls.length === 0) return showLoading(true, "Stream not available.");

        // à¦¡à¦¿à¦«à¦²à§à¦Ÿ à¦ªà§à¦°à¦¥à¦® à¦•à§‹à§Ÿà¦¾à¦²à¦¿à¦Ÿà¦¿ (à¦¸à¦¾à¦§à¦¾à¦°à¦£à¦¤ 1080p à¦¬à¦¾ 720p)
        const defaultStream = qualityUrls[0];
        currentQuality = defaultStream.quality;
        buildQualityMenu();

        // à´ªàµà´°à¦•à§à¦¸à¦¿à¦° à¦®à¦¾à¦§à§à¦¯à¦®à§‡ à¦«à¦¾à¦‡à¦² à¦²à§‹à¦¡
        const finalPlayUrl = proxyBaseUrl + encodeURIComponent(defaultStream.url);

        player = jwplayer('player');
        player.setup({
          file: finalPlayUrl,
          autostart: true,
          mute: false,
          width: '100%',
          height: '100%',
          stretching: 'uniform',
          controls: true,
          primary: 'html5',
          hlshtml: true,
          androidhls: true,
          preload: 'auto'
        });

        player.on('ready', () => {
          showLoading(false);
          addQualityButton();
          isPlayerReady = true;
          isLoading = false;
        });

        player.on('error', () => {
          showLoading(true, "Stream Error. Please reload.");
        });

      } catch (err) {
        showLoading(true, "Failed to load JSON data.");
        console.error(err);
      }
    }

    loadStreamFromId();
  </script>

  <!-- Anti Adblock / Brave Shield Script -->
  <div class="adb" id="adb" style="display: none;">
    <div class="adbs">
      <h3>Adblock/Brave Shields Detected</h3>
      <p>Please disable your adblocker or Brave Shields to continue browsing.</p>
    </div>
  </div>
  <style>
    .adb { position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, 0.85); z-index: 99999; display: flex; align-items: center; justify-content: center; }
    .adbs { background: #fff; padding: 30px; border-radius: 12px; text-align: center; max-width: 400px; width: 90%; font-family: Arial, sans-serif;}
    .adbs h3 { color: #d00; margin-bottom: 15px; }
  </style>
  <script>
    async function checkAdblock() {
      let blocked = false;
      const bait = document.createElement("div");
      bait.className = "ad adsbox ad-banner adsense ad-container sponsored";
      bait.style.cssText = "width:1px;height:1px;position:absolute;left:-9999px;";
      document.body.appendChild(bait);
      await new Promise(r => setTimeout(r, 500));
      if (window.getComputedStyle(bait).display === "none" || bait.offsetHeight === 0) blocked = true;
      bait.remove();
      return blocked;
    }
    window.addEventListener("load", async () => {
      if (await checkAdblock()) {
        document.getElementById("adb").style.display = "flex";
      }
    });
  </script>
</body>
</html>
